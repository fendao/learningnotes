学了p，权作复习  
研究时间戳（具体时刻）、区间（一个月一年）、间隔（始与终之间）
# 时间数据的类型与工具
from datetime import datetime  
对datetime：  
    now()获取此刻、year\month\day属性  
    datetime.timedelta对象=两个时间数据相减的时间差  
    datetime对象 + timedelta对象 = datetime对象  
    **datetime模块数据类型表**
## 字符串转datetime
str(datetime())转字符串  
方法datetime().strftime('%Y-%m-%d')转datetime对象  
函数datetime.strptime(value, '%Y-%m-%d')转datetime对象  
**datetime格式表**  
dateutil包：parse(各格式字符串)转datetime  
to_datetime()方法：pd.to_datetime()生成DatetimeIndex
# 11.2时间序列基础
pd基础时间序列是时间戳作索引的Series，其他是py字符串或datetime  
时间索引：pd.Series(np.random.randn(2), index=[datetime(2011,1,1), datetime(2011,1,2)])  
DatetimeIndex的单值是pd的时间戳Timestamp对象
## 索引、选择与子集
索引自生成数，索引行索引、索引日期字符串、索引区间即是字符串、  
切片方法：  
    ts.truncate(after='1/9/2011')
## 含重复索引
检查索引是否唯一ts.index.is_unique  
对重复索引数据聚合：  
    ts.groupby(level=0)
# 11.3范围、频率与位移
时间序列转固定频率：  
    ts.resample('D')
## 生成范围
根据频率生成的DatetimeIndex：  
     pd.date_range('2012-4-1', periods=20, freq='BM')  
     pd.date_range('2012-4-1', '2012-12-1', freq='BM', normalize=True)标准化到0点  
     **时间序列频率表**
## 频率与日期偏置
频率：基础频率\*倍数：freq='4h'——>Hour(4)  
锚定偏置量：不均匀分隔，看情况取时间点
## 位移日期
Series、DataFrame自带的方法：  
    ts.shift(2, freq='M')指定频率，则数据跟着时间轴一起跑  
用偏置位移：  
    datetime() + 3\*Day()  
    用锚定偏置量：  
        MonthEnd().rollforward(datetime())向前滚  
        MonthEnd().rollback(datetime())向后滚
# 11.4处理时区。。。
国际标准UTC，时区被称为UTC的偏置  
import pytz  
pytz.timezone()获得时区对象
## 时区本地化
转简单时区（无定义时区）：  
    ts.tz_localize('UTC')  
转特定时区：  
    ts2.tz_convert('UTC')  
    也可直接DateFrame.index.tz_localize()
## 时区感知时间戳
## 不同时区的操作
相加=UTC
# 11.5时间区间和区间算术
pd.Period('2007', 'A-DEC')表全年时间段  
规则区间序列：  
    pd.period_range('2000-1-1','2000-1-2',freq='D')生成PeriodIndex对象
## 区间频率转换
针对Period和PeriodIndex对象：  
    pd.Period('2000',freq='A-DEC').asfreq('M', how='end')要最后月
## 季度区间频率
会计金融常用数据：  
    p = pd.Period('2021Q4',freq='Q-JAN')该月所在季度（1月为该财年结束月）  
    p.asfreq('D','end')本季度最后一天  
本季度倒数第二个工作日下午4点的时间戳：  
    (pd.Period('2021Q4',freq='Q-JAN').asfreq('B','e')-1).asfreq('T','s')+16\*60  
    .to_timestamp()
## 时间戳转区间
to_period:  
    pd.date_range('2000-1-1',periods=3).to_period('M').to_timestamp(how='end')  
    结果会去掉day，指定M频率的区间，再转时间戳
## 数组生成PeriodIndex
联合所有数组形成DF索引：  
    pd.PeriodIndex(year=data.year, quarter=data.quarter, freq='Q-DEC')
# 11.6重新采样（频率转换
向下采样：高频到低频；向上：低频到高频  
resample()：  
    由day索引转Month索引分组再聚合：ts.resample('M',kind='period').mean()  
    **resample参数表**
## 向下采
须考虑closed与label：  
    由一分钟频率聚到五分钟：  
        ts=pd.Series(np.arange(12),index=pd.date_range('2000-1-1',periods=12,freq='T'))  
        ts.resample('5min', closed='right', label='right').sum()  
                            闭合端（包含）改为右、由左启箱改为右启  
    to_offset()方法减去_秒  
    结合ohlc函数：ts.resample('3min').ohlc()生成间隔3分钟的始终大小统计列
## 向上采与插值
用resample由周转日再asfreq()会产生缺失值  
建议frame.resample('D').ffill()
## 用区间重新采
区间索引：index=pd.period_range()  
向下采、向上采、convention参数
# 11.7移动窗口函数？？？？？
rolling算子移动窗口分组：  
扩展均值expanding().mean()：
## 指数加权函数？？？？？
常数衰减因子：  
ewm算子：  
定义span的EW移动平均线：
## 二元移动窗口函数？？？？？
corr计算滚动相关性：  
rolling_corr:
## rolling外加apply自定义函数


```python

from datetime import datetime
import numpy as np
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt
```


```python
now = datetime.now()
```


```python
now
```




    datetime.datetime(2022, 3, 1, 9, 11, 9, 607920)




```python
now.year, now.month, now.day
```




    (2022, 3, 1)




```python
delta = datetime(2011, 1, 7) - datetime(2008,6,24,8,15)
```


```python
delta
```




    datetime.timedelta(days=926, seconds=56700)




```python
delta.seconds
```




    56700




```python
from datetime import timedelta
```


```python
start = datetime(2011,1,7)
start + timedelta(12)

```




    datetime.datetime(2011, 1, 19, 0, 0)




```python
start - 2 * timedelta(12)
```




    datetime.datetime(2010, 12, 14, 0, 0)




```python
stamp = datetime(2011, 1, 3)
```


```python
str(stamp)
```




    '2011-01-03 00:00:00'




```python
stamp.strftime('%Y-%m-%d')
```




    '2011-01-03'




```python
value = '2011-1-3'
```


```python
datetime.strptime(value, '%Y-%m-%d')
```




    datetime.datetime(2011, 1, 3, 0, 0)




```python
datestrs = ['7/6/2011', '8/6/2011']
```


```python
[datetime.strptime(x, '%m/%d/%Y') for x in datestrs]
```




    [datetime.datetime(2011, 7, 6, 0, 0), datetime.datetime(2011, 8, 6, 0, 0)]




```python
from dateutil.parser import parse
```


```python
parse('2011-1-3')
```




    datetime.datetime(2011, 1, 3, 0, 0)




```python
parse('Jan 31, 1997 10:45 PM')
```




    datetime.datetime(1997, 1, 31, 22, 45)




```python
parse('6/12/2011', dayfirst=True)
```




    datetime.datetime(2011, 12, 6, 0, 0)




```python
datestrs = ['2011-7-6 12:00:00', '2011-8-6 00:00:00']
```


```python
pd.to_datetime(datestrs)
```




    DatetimeIndex(['2011-07-06 12:00:00', '2011-08-06 00:00:00'], dtype='datetime64[ns]', freq=None)




```python
idx = pd.to_datetime(datestrs + [None])
```


```python
idx
```




    DatetimeIndex(['2011-07-06 12:00:00', '2011-08-06 00:00:00', 'NaT'], dtype='datetime64[ns]', freq=None)




```python
idx[2]
```




    NaT




```python
pd.isnull(idx)
```




    array([False, False,  True])




```python
dates = [datetime(2011,1,2),datetime(2011,1,5),datetime(2011,1,7),
                                    datetime(2011,1,8),datetime(2011,1,10),datetime(2011,1,12)]
```


```python
ts = pd.Series(np.random.randn(6), index=dates)
```


```python
ts
```




    2011-01-02   -0.808724
    2011-01-05   -0.201235
    2011-01-07   -0.398694
    2011-01-08   -2.650519
    2011-01-10   -1.623641
    2011-01-12    0.356922
    dtype: float64




```python
ts.index
```




    DatetimeIndex(['2011-01-02', '2011-01-05', '2011-01-07', '2011-01-08',
                   '2011-01-10', '2011-01-12'],
                  dtype='datetime64[ns]', freq=None)




```python
ts + ts[::2]
```




    2011-01-02   -1.617447
    2011-01-05         NaN
    2011-01-07   -0.797387
    2011-01-08         NaN
    2011-01-10   -3.247283
    2011-01-12         NaN
    dtype: float64




```python
ts[::2]
```




    2011-01-02   -0.808724
    2011-01-07   -0.398694
    2011-01-10   -1.623641
    dtype: float64




```python
ts.index.dtype
```




    dtype('<M8[ns]')




```python
stamp = ts.index[0]
```


```python
stamp
```




    Timestamp('2011-01-02 00:00:00')




```python
stamp = ts.index[2]
```


```python
ts[stamp]
```




    -0.3986935677992045




```python
ts['1/10/2011']
```




    -1.62364136016541




```python
ts['20110110']
```




    -1.62364136016541




```python
longer_ts = pd.Series(np.random.randn(1000), index=pd.date_range('1/1/2000', periods=1000))
```


```python
longer_ts
```




    2000-01-01    0.427327
    2000-01-02    0.418939
    2000-01-03   -0.810465
    2000-01-04   -0.572488
    2000-01-05    0.662706
                    ...   
    2002-09-22   -0.178435
    2002-09-23    0.524632
    2002-09-24    0.854674
    2002-09-25    0.171988
    2002-09-26   -1.232594
    Freq: D, Length: 1000, dtype: float64




```python
longer_ts['2001']
```




    2001-01-01    0.248351
    2001-01-02   -0.103376
    2001-01-03    1.616259
    2001-01-04   -0.879280
    2001-01-05   -1.827189
                    ...   
    2001-12-27    1.497113
    2001-12-28   -0.876592
    2001-12-29   -0.415296
    2001-12-30    0.187009
    2001-12-31    1.236978
    Freq: D, Length: 365, dtype: float64




```python
longer_ts['2001-05']
```




    2001-05-01    1.207408
    2001-05-02   -1.225356
    2001-05-03    1.746675
    2001-05-04    1.219576
    2001-05-05    0.330240
    2001-05-06   -0.570147
    2001-05-07   -0.196966
    2001-05-08    2.046350
    2001-05-09   -0.321317
    2001-05-10    1.175732
    2001-05-11    0.041434
    2001-05-12   -0.224022
    2001-05-13   -0.267434
    2001-05-14    0.976001
    2001-05-15    0.753561
    2001-05-16   -1.137762
    2001-05-17   -0.344056
    2001-05-18    0.073118
    2001-05-19   -0.306360
    2001-05-20   -1.273359
    2001-05-21   -0.308020
    2001-05-22    0.057632
    2001-05-23   -0.893096
    2001-05-24   -0.817310
    2001-05-25   -0.301912
    2001-05-26   -1.136560
    2001-05-27    0.614626
    2001-05-28    0.790601
    2001-05-29    1.734246
    2001-05-30   -0.841619
    2001-05-31    0.051976
    Freq: D, dtype: float64




```python
ts[datetime(2011,1,7):]
```




    2011-01-07   -0.398694
    2011-01-08   -2.650519
    2011-01-10   -1.623641
    2011-01-12    0.356922
    dtype: float64




```python
ts
```




    2011-01-02   -0.808724
    2011-01-05   -0.201235
    2011-01-07   -0.398694
    2011-01-08   -2.650519
    2011-01-10   -1.623641
    2011-01-12    0.356922
    dtype: float64




```python
ts['1/6/2011':'1/11/2011']
```




    2011-01-07   -0.398694
    2011-01-08   -2.650519
    2011-01-10   -1.623641
    dtype: float64




```python
ts.truncate(after='1/9/2011')
```




    2011-01-02   -0.808724
    2011-01-05   -0.201235
    2011-01-07   -0.398694
    2011-01-08   -2.650519
    dtype: float64




```python
dates = pd.date_range('1/1/2000', periods=100, freq='W-WED')
```


```python
long_df = pd.DataFrame(np.random.randn(100,4),
                      index=dates,
                      columns=['Colorado','Texas','New York','Ohio'])
```


```python
long_df.loc['5-2001']
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Colorado</th>
      <th>Texas</th>
      <th>New York</th>
      <th>Ohio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2001-05-02</th>
      <td>-1.169521</td>
      <td>-1.256464</td>
      <td>1.340425</td>
      <td>-0.096607</td>
    </tr>
    <tr>
      <th>2001-05-09</th>
      <td>-1.431254</td>
      <td>0.273074</td>
      <td>-2.594007</td>
      <td>1.522076</td>
    </tr>
    <tr>
      <th>2001-05-16</th>
      <td>0.634810</td>
      <td>-0.273751</td>
      <td>0.936826</td>
      <td>-1.658277</td>
    </tr>
    <tr>
      <th>2001-05-23</th>
      <td>-0.579983</td>
      <td>-0.133032</td>
      <td>-0.314664</td>
      <td>1.407009</td>
    </tr>
    <tr>
      <th>2001-05-30</th>
      <td>1.215985</td>
      <td>-0.135077</td>
      <td>0.453087</td>
      <td>3.317712</td>
    </tr>
  </tbody>
</table>
</div>




```python
dates = pd.DatetimeIndex(['1/1/2000','1/2/2000','1/2/2000','1/2/2000','1/3/2000'])
```


```python
dup_ts = pd.Series(np.arange(5), index=dates)
```


```python
dup_ts
```




    2000-01-01    0
    2000-01-02    1
    2000-01-02    2
    2000-01-02    3
    2000-01-03    4
    dtype: int64




```python
dup_ts.index.is_unique
```




    False




```python
dup_ts['1/3/2000']
```




    4




```python
dup_ts['1/2/2000']
```




    2000-01-02    1
    2000-01-02    2
    2000-01-02    3
    dtype: int64




```python
grouped = dup_ts.groupby(level=0)
```


```python
grouped.mean()
```




    2000-01-01    0.0
    2000-01-02    2.0
    2000-01-03    4.0
    dtype: float64




```python
grouped.count()
```




    2000-01-01    1
    2000-01-02    3
    2000-01-03    1
    dtype: int64




```python
ts
```




    2011-01-02   -0.808724
    2011-01-05   -0.201235
    2011-01-07   -0.398694
    2011-01-08   -2.650519
    2011-01-10   -1.623641
    2011-01-12    0.356922
    dtype: float64




```python
resampler= ts.resample('D')
```


```python
index = pd.date_range('2012-4-1','2012-6-1')
```


```python
index
```




    DatetimeIndex(['2012-04-01', '2012-04-02', '2012-04-03', '2012-04-04',
                   '2012-04-05', '2012-04-06', '2012-04-07', '2012-04-08',
                   '2012-04-09', '2012-04-10', '2012-04-11', '2012-04-12',
                   '2012-04-13', '2012-04-14', '2012-04-15', '2012-04-16',
                   '2012-04-17', '2012-04-18', '2012-04-19', '2012-04-20',
                   '2012-04-21', '2012-04-22', '2012-04-23', '2012-04-24',
                   '2012-04-25', '2012-04-26', '2012-04-27', '2012-04-28',
                   '2012-04-29', '2012-04-30', '2012-05-01', '2012-05-02',
                   '2012-05-03', '2012-05-04', '2012-05-05', '2012-05-06',
                   '2012-05-07', '2012-05-08', '2012-05-09', '2012-05-10',
                   '2012-05-11', '2012-05-12', '2012-05-13', '2012-05-14',
                   '2012-05-15', '2012-05-16', '2012-05-17', '2012-05-18',
                   '2012-05-19', '2012-05-20', '2012-05-21', '2012-05-22',
                   '2012-05-23', '2012-05-24', '2012-05-25', '2012-05-26',
                   '2012-05-27', '2012-05-28', '2012-05-29', '2012-05-30',
                   '2012-05-31', '2012-06-01'],
                  dtype='datetime64[ns]', freq='D')




```python
pd.date_range(start='2012-4-1',periods=20)
```




    DatetimeIndex(['2012-04-01', '2012-04-02', '2012-04-03', '2012-04-04',
                   '2012-04-05', '2012-04-06', '2012-04-07', '2012-04-08',
                   '2012-04-09', '2012-04-10', '2012-04-11', '2012-04-12',
                   '2012-04-13', '2012-04-14', '2012-04-15', '2012-04-16',
                   '2012-04-17', '2012-04-18', '2012-04-19', '2012-04-20'],
                  dtype='datetime64[ns]', freq='D')




```python
pd.date_range(end='2012-6-1',periods=20)
```




    DatetimeIndex(['2012-05-13', '2012-05-14', '2012-05-15', '2012-05-16',
                   '2012-05-17', '2012-05-18', '2012-05-19', '2012-05-20',
                   '2012-05-21', '2012-05-22', '2012-05-23', '2012-05-24',
                   '2012-05-25', '2012-05-26', '2012-05-27', '2012-05-28',
                   '2012-05-29', '2012-05-30', '2012-05-31', '2012-06-01'],
                  dtype='datetime64[ns]', freq='D')




```python
pd.date_range('2000-1-1','2000-12-1',freq='BM')
```




    DatetimeIndex(['2000-01-31', '2000-02-29', '2000-03-31', '2000-04-28',
                   '2000-05-31', '2000-06-30', '2000-07-31', '2000-08-31',
                   '2000-09-29', '2000-10-31', '2000-11-30'],
                  dtype='datetime64[ns]', freq='BM')




```python
pd.date_range('2012-5-2 12:56:31',periods=5)
```




    DatetimeIndex(['2012-05-02 12:56:31', '2012-05-03 12:56:31',
                   '2012-05-04 12:56:31', '2012-05-05 12:56:31',
                   '2012-05-06 12:56:31'],
                  dtype='datetime64[ns]', freq='D')




```python
pd.date_range('2012-5-2 12:56:31',periods=5, normalize=True)
```




    DatetimeIndex(['2012-05-02', '2012-05-03', '2012-05-04', '2012-05-05',
                   '2012-05-06'],
                  dtype='datetime64[ns]', freq='D')




```python
from pandas.tseries.offsets import Hour,Minute
```


```python
hour = Hour()
```


```python
hour
```




    <Hour>




```python
four_hours = Hour(4)
```


```python
four_hours
```




    <4 * Hours>




```python
pd.date_range('2000-1-1','2000-1-3 23:59',freq='4h')
```




    DatetimeIndex(['2000-01-01 00:00:00', '2000-01-01 04:00:00',
                   '2000-01-01 08:00:00', '2000-01-01 12:00:00',
                   '2000-01-01 16:00:00', '2000-01-01 20:00:00',
                   '2000-01-02 00:00:00', '2000-01-02 04:00:00',
                   '2000-01-02 08:00:00', '2000-01-02 12:00:00',
                   '2000-01-02 16:00:00', '2000-01-02 20:00:00',
                   '2000-01-03 00:00:00', '2000-01-03 04:00:00',
                   '2000-01-03 08:00:00', '2000-01-03 12:00:00',
                   '2000-01-03 16:00:00', '2000-01-03 20:00:00'],
                  dtype='datetime64[ns]', freq='4H')




```python
Hour(2) + Minute(30)
```




    <150 * Minutes>




```python
pd.date_range('2000-1-1',periods=10,freq='1h30min')
```




    DatetimeIndex(['2000-01-01 00:00:00', '2000-01-01 01:30:00',
                   '2000-01-01 03:00:00', '2000-01-01 04:30:00',
                   '2000-01-01 06:00:00', '2000-01-01 07:30:00',
                   '2000-01-01 09:00:00', '2000-01-01 10:30:00',
                   '2000-01-01 12:00:00', '2000-01-01 13:30:00'],
                  dtype='datetime64[ns]', freq='90T')




```python
rng = pd.date_range('2012-1-1','2012-9-1',freq='WOM-3FRI')
```


```python
list(rng)
```




    [Timestamp('2012-01-20 00:00:00', freq='WOM-3FRI'),
     Timestamp('2012-02-17 00:00:00', freq='WOM-3FRI'),
     Timestamp('2012-03-16 00:00:00', freq='WOM-3FRI'),
     Timestamp('2012-04-20 00:00:00', freq='WOM-3FRI'),
     Timestamp('2012-05-18 00:00:00', freq='WOM-3FRI'),
     Timestamp('2012-06-15 00:00:00', freq='WOM-3FRI'),
     Timestamp('2012-07-20 00:00:00', freq='WOM-3FRI'),
     Timestamp('2012-08-17 00:00:00', freq='WOM-3FRI')]




```python
ts = pd.Series(np.random.randn(4),
              index=pd.date_range('1/1/2000',periods=4,freq='M'))
```


```python
ts
```




    2000-01-31   -1.337661
    2000-02-29    1.220271
    2000-03-31    0.642479
    2000-04-30    1.738889
    Freq: M, dtype: float64




```python
ts.shift(2)
```




    2000-01-31         NaN
    2000-02-29         NaN
    2000-03-31   -1.337661
    2000-04-30    1.220271
    Freq: M, dtype: float64




```python
ts.shift(-2)
```




    2000-01-31    0.642479
    2000-02-29    1.738889
    2000-03-31         NaN
    2000-04-30         NaN
    Freq: M, dtype: float64




```python
ts/ts.shift(1)-1
```




    2000-01-31         NaN
    2000-02-29   -1.912242
    2000-03-31   -0.473495
    2000-04-30    1.706529
    Freq: M, dtype: float64




```python
ts.shift(2, freq='M')
```




    2000-03-31   -1.337661
    2000-04-30    1.220271
    2000-05-31    0.642479
    2000-06-30    1.738889
    Freq: M, dtype: float64




```python
ts.shift(3, freq='D')
```




    2000-02-03   -1.337661
    2000-03-03    1.220271
    2000-04-03    0.642479
    2000-05-03    1.738889
    dtype: float64




```python
ts.shift(1, freq='90T')
```




    2000-01-31 01:30:00   -1.337661
    2000-02-29 01:30:00    1.220271
    2000-03-31 01:30:00    0.642479
    2000-04-30 01:30:00    1.738889
    dtype: float64




```python
from pandas.tseries.offsets import Day,MonthEnd
```


```python
now = datetime(2011,11,17)
```


```python
now + 3 * Day()
```




    Timestamp('2011-11-20 00:00:00')




```python
now + MonthEnd()
```




    Timestamp('2011-11-30 00:00:00')




```python
now + MonthEnd(2)
```




    Timestamp('2011-12-31 00:00:00')




```python
offset = MonthEnd()
```


```python
offset.rollforward(now)
```




    Timestamp('2011-11-30 00:00:00')




```python
offset.rollback(now)
```




    Timestamp('2011-10-31 00:00:00')




```python
ts = pd.Series(np.random.randn(20),
              index=pd.date_range('1/15/2000',periods=20,freq='4d'))
```


```python
ts
```




    2000-01-15    1.078889
    2000-01-19   -1.176042
    2000-01-23   -0.432751
    2000-01-27   -0.856073
    2000-01-31   -2.157665
    2000-02-04    0.206520
    2000-02-08   -1.284786
    2000-02-12    0.825373
    2000-02-16   -0.529673
    2000-02-20    0.843272
    2000-02-24   -0.678644
    2000-02-28   -0.125402
    2000-03-03    1.964927
    2000-03-07   -0.620013
    2000-03-11    1.293522
    2000-03-15    0.460302
    2000-03-19   -0.239051
    2000-03-23   -0.791669
    2000-03-27    0.688663
    2000-03-31   -1.420231
    Freq: 4D, dtype: float64




```python
ts.resample('M').mean()
```




    2000-01-31   -0.708728
    2000-02-29   -0.106192
    2000-03-31    0.167056
    Freq: M, dtype: float64




```python
ts.resample('M')
```




    <pandas.core.resample.DatetimeIndexResampler object at 0x7f9d0afebd50>




```python
import pytz
```


```python
pytz.common_timezones[-5:]
```




    ['US/Eastern', 'US/Hawaii', 'US/Mountain', 'US/Pacific', 'UTC']




```python
tz = pytz.timezone('America/New_York')
```


```python
tz
```




    <DstTzInfo 'America/New_York' LMT-1 day, 19:04:00 STD>




```python
rng = pd.date_range('3/9/2012 9:30', periods=6, freq='D')
```


```python
ts = pd.Series(np.random.randn(len(rng)), index=rng)
```


```python
ts
```




    2012-03-09 09:30:00    0.511272
    2012-03-10 09:30:00    1.251065
    2012-03-11 09:30:00   -1.639768
    2012-03-12 09:30:00   -1.099100
    2012-03-13 09:30:00    0.572337
    2012-03-14 09:30:00   -0.244592
    Freq: D, dtype: float64




```python
print(ts.index.tz)
```

    None



```python
pd.date_range('3/9/2012 9:30',periods=10,freq='D',tz='UTC')
```




    DatetimeIndex(['2012-03-09 09:30:00+00:00', '2012-03-10 09:30:00+00:00',
                   '2012-03-11 09:30:00+00:00', '2012-03-12 09:30:00+00:00',
                   '2012-03-13 09:30:00+00:00', '2012-03-14 09:30:00+00:00',
                   '2012-03-15 09:30:00+00:00', '2012-03-16 09:30:00+00:00',
                   '2012-03-17 09:30:00+00:00', '2012-03-18 09:30:00+00:00'],
                  dtype='datetime64[ns, UTC]', freq='D')




```python
ts_utc = ts.tz_localize('UTC')
```


```python
ts_utc
```




    2012-03-09 09:30:00+00:00    0.511272
    2012-03-10 09:30:00+00:00    1.251065
    2012-03-11 09:30:00+00:00   -1.639768
    2012-03-12 09:30:00+00:00   -1.099100
    2012-03-13 09:30:00+00:00    0.572337
    2012-03-14 09:30:00+00:00   -0.244592
    Freq: D, dtype: float64




```python
ts_utc.index
```




    DatetimeIndex(['2012-03-09 09:30:00+00:00', '2012-03-10 09:30:00+00:00',
                   '2012-03-11 09:30:00+00:00', '2012-03-12 09:30:00+00:00',
                   '2012-03-13 09:30:00+00:00', '2012-03-14 09:30:00+00:00'],
                  dtype='datetime64[ns, UTC]', freq='D')




```python
ts_utc.tz_convert('America/New_York')
```




    2012-03-09 04:30:00-05:00    0.511272
    2012-03-10 04:30:00-05:00    1.251065
    2012-03-11 05:30:00-04:00   -1.639768
    2012-03-12 05:30:00-04:00   -1.099100
    2012-03-13 05:30:00-04:00    0.572337
    2012-03-14 05:30:00-04:00   -0.244592
    Freq: D, dtype: float64




```python
ts_eastern = ts.tz_localize('America/New_York')
```


```python
ts_eastern.tz_convert('UTC')
```




    2012-03-09 14:30:00+00:00    0.511272
    2012-03-10 14:30:00+00:00    1.251065
    2012-03-11 13:30:00+00:00   -1.639768
    2012-03-12 13:30:00+00:00   -1.099100
    2012-03-13 13:30:00+00:00    0.572337
    2012-03-14 13:30:00+00:00   -0.244592
    dtype: float64




```python
ts_eastern.tz_convert('Europe/Berlin')
```




    2012-03-09 15:30:00+01:00    0.511272
    2012-03-10 15:30:00+01:00    1.251065
    2012-03-11 14:30:00+01:00   -1.639768
    2012-03-12 14:30:00+01:00   -1.099100
    2012-03-13 14:30:00+01:00    0.572337
    2012-03-14 14:30:00+01:00   -0.244592
    dtype: float64




```python
ts.index.tz_localize('Asia/Shanghai')
```




    DatetimeIndex(['2012-03-09 09:30:00+08:00', '2012-03-10 09:30:00+08:00',
                   '2012-03-11 09:30:00+08:00', '2012-03-12 09:30:00+08:00',
                   '2012-03-13 09:30:00+08:00', '2012-03-14 09:30:00+08:00'],
                  dtype='datetime64[ns, Asia/Shanghai]', freq=None)




```python
stamp = pd.Timestamp('2011-3-12 4:00')
```


```python
stamp_utc = stamp.tz_localize('utc')
```


```python
stamp_utc.tz_convert('America/New_York')
```




    Timestamp('2011-03-11 23:00:00-0500', tz='America/New_York')




```python
stamp_moscow = pd.Timestamp('2011-3-12 4:00',tz='Europe/Moscow')
```


```python
stamp_moscow
```




    Timestamp('2011-03-12 04:00:00+0300', tz='Europe/Moscow')




```python
stamp_utc.value
```




    1299902400000000000




```python
stamp_utc.tz_convert('America/New_York').value
```




    1299902400000000000




```python
from pandas.tseries.offsets import Hour
```


```python
stamp = pd.Timestamp('2012-3-12 1:30', tz='US/Eastern')
```


```python
stamp
```




    Timestamp('2012-03-12 01:30:00-0400', tz='US/Eastern')




```python
stamp + Hour()
```




    Timestamp('2012-03-12 02:30:00-0400', tz='US/Eastern')




```python
stamp = pd.Timestamp('2012-3-12 0:30', tz='US/Eastern')
```


```python
stamp
```




    Timestamp('2012-03-12 00:30:00-0400', tz='US/Eastern')




```python
stamp + 2*Hour()
```




    Timestamp('2012-03-12 02:30:00-0400', tz='US/Eastern')




```python
rng = pd.date_range('3/7/2012 9:30', periods=10, freq='B')
```


```python
ts = pd.Series(np.random.randn(len(rng)), index=rng)
```


```python
ts
```




    2012-03-07 09:30:00    0.888307
    2012-03-08 09:30:00    0.874162
    2012-03-09 09:30:00    0.097194
    2012-03-12 09:30:00   -1.489621
    2012-03-13 09:30:00    0.785561
    2012-03-14 09:30:00   -1.682266
    2012-03-15 09:30:00   -0.390889
    2012-03-16 09:30:00    1.907614
    2012-03-19 09:30:00   -1.123930
    2012-03-20 09:30:00   -0.587105
    Freq: B, dtype: float64




```python
ts1 = ts[:7].tz_localize('Europe/London')
```


```python
ts2 = ts1[2:].tz_convert('Europe/Moscow')
```


```python
result = ts1 + ts2
```


```python
result.index
```




    DatetimeIndex(['2012-03-07 09:30:00+00:00', '2012-03-08 09:30:00+00:00',
                   '2012-03-09 09:30:00+00:00', '2012-03-12 09:30:00+00:00',
                   '2012-03-13 09:30:00+00:00', '2012-03-14 09:30:00+00:00',
                   '2012-03-15 09:30:00+00:00'],
                  dtype='datetime64[ns, UTC]', freq=None)




```python
p = pd.Period(2007, freq='A-DEC')
```


```python
p
```




    Period('2007', 'A-DEC')




```python
p + 5
```




    Period('2012', 'A-DEC')




```python
p - 2
```




    Period('2005', 'A-DEC')




```python
pd.Period('2014', freq='A-DEC') - p
```




    <7 * YearEnds: month=12>




```python
rng = pd.period_range('2000-1-1','2000-6-30',freq='M')
```


```python
rng
```




    PeriodIndex(['2000-01', '2000-02', '2000-03', '2000-04', '2000-05', '2000-06'], dtype='period[M]')




```python
pd.Series(np.random.randn(6), index=rng)
```




    2000-01   -0.053396
    2000-02   -0.197822
    2000-03    0.372473
    2000-04    1.423918
    2000-05   -1.549658
    2000-06    1.106721
    Freq: M, dtype: float64




```python
values = ['200103','200202','200301']
```


```python
index = pd.PeriodIndex(values, freq='Q-DEC')
```


```python
index
```




    PeriodIndex(['2003Q1', '2002Q1', '2001Q1'], dtype='period[Q-DEC]')




```python
p = pd.Period('2007',freq='A-DEC')
```


```python
p
```




    Period('2007', 'A-DEC')




```python
p.asfreq('M',how='start')
```




    Period('2007-01', 'M')




```python
p.asfreq('M',how='end')
```




    Period('2007-12', 'M')




```python
p = pd.Period('Aug-2007','M')
```


```python
p.asfreq('A-JUN')
```




    Period('2008', 'A-JUN')




```python
rng = pd.period_range('2006','2009',freq='A-DEC')
```


```python
ts = pd.Series(np.random.randn(len(rng)), index=rng)
```


```python
ts
```




    2006    1.675620
    2007   -0.416387
    2008    0.378701
    2009   -0.145351
    Freq: A-DEC, dtype: float64




```python
ts.asfreq('M',how='start')
```




    2006-01    1.675620
    2007-01   -0.416387
    2008-01    0.378701
    2009-01   -0.145351
    Freq: M, dtype: float64




```python
ts.asfreq('B',how='end')
```




    2006-12-29    1.675620
    2007-12-31   -0.416387
    2008-12-31    0.378701
    2009-12-31   -0.145351
    Freq: B, dtype: float64




```python
p = pd.Period('2012Q4',freq='Q-JAN')
```


```python
p
```




    Period('2012Q4', 'Q-JAN')




```python
p.asfreq('D','start')
```




    Period('2011-11-01', 'D')




```python
p.asfreq('D','end')
```




    Period('2012-01-31', 'D')




```python
p4pm = (p.asfreq('B','e')-1).asfreq('T','s') + 16*60
```


```python
p4pm
```




    Period('2012-01-30 16:00', 'T')




```python
p4pm.to_timestamp()
```




    Timestamp('2012-01-30 16:00:00')




```python
rng = pd.period_range('2011Q3','2012Q4',freq='Q-JAN')
```


```python
ts = pd.Series(np.arange(len(rng)), index=rng)
```


```python
ts
```




    2011Q3    0
    2011Q4    1
    2012Q1    2
    2012Q2    3
    2012Q3    4
    2012Q4    5
    Freq: Q-JAN, dtype: int64




```python
new_rng = (rng.asfreq('B','e')-1).asfreq('T','s')+ 16*60
```


```python
ts.index = new_rng.to_timestamp()
```


```python
ts
```




    2010-10-28 16:00:00    0
    2011-01-28 16:00:00    1
    2011-04-28 16:00:00    2
    2011-07-28 16:00:00    3
    2011-10-28 16:00:00    4
    2012-01-30 16:00:00    5
    dtype: int64




```python
rng = pd.date_range('2000-1-1',periods=3,freq='M')
```


```python
ts = pd.Series(np.random.randn(3),index=rng)
```


```python
ts
```




    2000-01-31    0.784227
    2000-02-29   -0.903635
    2000-03-31   -0.148387
    Freq: M, dtype: float64




```python
pts = ts.to_period()
```


```python
pts
```




    2000-01    0.784227
    2000-02   -0.903635
    2000-03   -0.148387
    Freq: M, dtype: float64




```python
rng = pd.date_range('1/29/2000',periods=6,freq='D')
```


```python
ts2 = pd.Series(np.random.randn(6),rng)
```


```python
ts2
```




    2000-01-29   -1.613453
    2000-01-30   -0.455401
    2000-01-31   -0.989629
    2000-02-01   -0.798713
    2000-02-02    0.303485
    2000-02-03   -0.850052
    Freq: D, dtype: float64




```python
ts2.to_period('M')
```




    2000-01   -1.613453
    2000-01   -0.455401
    2000-01   -0.989629
    2000-02   -0.798713
    2000-02    0.303485
    2000-02   -0.850052
    Freq: M, dtype: float64




```python
pts = ts2.to_period()
```


```python
pts.to_timestamp(how='end')
```




    2000-01-29 23:59:59.999999999   -1.613453
    2000-01-30 23:59:59.999999999   -0.455401
    2000-01-31 23:59:59.999999999   -0.989629
    2000-02-01 23:59:59.999999999   -0.798713
    2000-02-02 23:59:59.999999999    0.303485
    2000-02-03 23:59:59.999999999   -0.850052
    Freq: D, dtype: float64




```python
data = pd.read_csv('examples/macrodata.csv')
```


```python
data.head(5)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>quarter</th>
      <th>realgdp</th>
      <th>realcons</th>
      <th>realinv</th>
      <th>realgovt</th>
      <th>realdpi</th>
      <th>cpi</th>
      <th>m1</th>
      <th>tbilrate</th>
      <th>unemp</th>
      <th>pop</th>
      <th>infl</th>
      <th>realint</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1959.0</td>
      <td>1.0</td>
      <td>2710.349</td>
      <td>1707.4</td>
      <td>286.898</td>
      <td>470.045</td>
      <td>1886.9</td>
      <td>28.98</td>
      <td>139.7</td>
      <td>2.82</td>
      <td>5.8</td>
      <td>177.146</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1959.0</td>
      <td>2.0</td>
      <td>2778.801</td>
      <td>1733.7</td>
      <td>310.859</td>
      <td>481.301</td>
      <td>1919.7</td>
      <td>29.15</td>
      <td>141.7</td>
      <td>3.08</td>
      <td>5.1</td>
      <td>177.830</td>
      <td>2.34</td>
      <td>0.74</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1959.0</td>
      <td>3.0</td>
      <td>2775.488</td>
      <td>1751.8</td>
      <td>289.226</td>
      <td>491.260</td>
      <td>1916.4</td>
      <td>29.35</td>
      <td>140.5</td>
      <td>3.82</td>
      <td>5.3</td>
      <td>178.657</td>
      <td>2.74</td>
      <td>1.09</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1959.0</td>
      <td>4.0</td>
      <td>2785.204</td>
      <td>1753.7</td>
      <td>299.356</td>
      <td>484.052</td>
      <td>1931.3</td>
      <td>29.37</td>
      <td>140.0</td>
      <td>4.33</td>
      <td>5.6</td>
      <td>179.386</td>
      <td>0.27</td>
      <td>4.06</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1960.0</td>
      <td>1.0</td>
      <td>2847.699</td>
      <td>1770.5</td>
      <td>331.722</td>
      <td>462.199</td>
      <td>1955.5</td>
      <td>29.54</td>
      <td>139.6</td>
      <td>3.50</td>
      <td>5.2</td>
      <td>180.007</td>
      <td>2.31</td>
      <td>1.19</td>
    </tr>
  </tbody>
</table>
</div>




```python
data.year
```




    0      1959.0
    1      1959.0
    2      1959.0
    3      1959.0
    4      1960.0
            ...  
    198    2008.0
    199    2008.0
    200    2009.0
    201    2009.0
    202    2009.0
    Name: year, Length: 203, dtype: float64




```python
data.quarter
```




    0      1.0
    1      2.0
    2      3.0
    3      4.0
    4      1.0
          ... 
    198    3.0
    199    4.0
    200    1.0
    201    2.0
    202    3.0
    Name: quarter, Length: 203, dtype: float64




```python
index = pd.PeriodIndex(year=data.year,quarter=data.quarter, freq='Q-DEC')
```


```python
index
```




    PeriodIndex(['1959Q1', '1959Q2', '1959Q3', '1959Q4', '1960Q1', '1960Q2',
                 '1960Q3', '1960Q4', '1961Q1', '1961Q2',
                 ...
                 '2007Q2', '2007Q3', '2007Q4', '2008Q1', '2008Q2', '2008Q3',
                 '2008Q4', '2009Q1', '2009Q2', '2009Q3'],
                dtype='period[Q-DEC]', length=203)




```python
data.index = index
```


```python
data.infl
```




    1959Q1    0.00
    1959Q2    2.34
    1959Q3    2.74
    1959Q4    0.27
    1960Q1    2.31
              ... 
    2008Q3   -3.16
    2008Q4   -8.79
    2009Q1    0.94
    2009Q2    3.37
    2009Q3    3.56
    Freq: Q-DEC, Name: infl, Length: 203, dtype: float64




```python
rng = pd.date_range('2000-1-1',periods=100,freq='D')
```


```python
ts = pd.Series(np.random.randn(len(rng)), index=rng)
```


```python
ts
```




    2000-01-01   -0.286553
    2000-01-02   -0.510279
    2000-01-03   -1.063480
    2000-01-04   -0.090575
    2000-01-05    0.202876
                    ...   
    2000-04-05    0.550480
    2000-04-06   -1.329340
    2000-04-07    0.981554
    2000-04-08   -1.242340
    2000-04-09    0.749317
    Freq: D, Length: 100, dtype: float64




```python
ts.resample('M').mean()
```




    2000-01-31   -0.275372
    2000-02-29    0.127869
    2000-03-31   -0.245427
    2000-04-30    0.014071
    Freq: M, dtype: float64




```python
ts.resample('M', kind='period').mean()
```




    2000-01   -0.275372
    2000-02    0.127869
    2000-03   -0.245427
    2000-04    0.014071
    Freq: M, dtype: float64




```python
rng = pd.date_range('2000-1-1',periods=12,freq='T')
```


```python
ts = pd.Series(np.arange(12), index=rng)
```


```python
ts
```




    2000-01-01 00:00:00     0
    2000-01-01 00:01:00     1
    2000-01-01 00:02:00     2
    2000-01-01 00:03:00     3
    2000-01-01 00:04:00     4
    2000-01-01 00:05:00     5
    2000-01-01 00:06:00     6
    2000-01-01 00:07:00     7
    2000-01-01 00:08:00     8
    2000-01-01 00:09:00     9
    2000-01-01 00:10:00    10
    2000-01-01 00:11:00    11
    Freq: T, dtype: int64




```python
ts.resample('5min', closed='right').sum()
```




    1999-12-31 23:55:00     0
    2000-01-01 00:00:00    15
    2000-01-01 00:05:00    40
    2000-01-01 00:10:00    11
    Freq: 5T, dtype: int64




```python
ts.resample('5min', closed='right', label='right').sum()
```




    2000-01-01 00:00:00     0
    2000-01-01 00:05:00    15
    2000-01-01 00:10:00    40
    2000-01-01 00:15:00    11
    Freq: 5T, dtype: int64




```python
ts.resample('5min',closed='right',label='right',loffset='-1s').sum()
```

    
    becomes:
    
    >>> from pandas.tseries.frequencies import to_offset
    >>> df = df.resample(freq="3s").mean()
    >>> df.index = df.index.to_timestamp() + to_offset("8H")
    
      """Entry point for launching an IPython kernel.





    1999-12-31 23:59:59     0
    2000-01-01 00:04:59    15
    2000-01-01 00:09:59    40
    2000-01-01 00:14:59    11
    Freq: 5T, dtype: int64




```python
from pandas.tseries.frequencies import to_offset
```


```python
ts2 = ts.resample('5min',closed='right',label='right').sum()
```


```python
ts2.index = ts2.index + to_offset('-1s')
```


```python
ts2.index
```




    DatetimeIndex(['1999-12-31 23:59:59', '2000-01-01 00:04:59',
                   '2000-01-01 00:09:59', '2000-01-01 00:14:59'],
                  dtype='datetime64[ns]', freq='5T')




```python
ts.resample('5min').ohlc()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open</th>
      <th>high</th>
      <th>low</th>
      <th>close</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-01 00:00:00</th>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2000-01-01 00:05:00</th>
      <td>5</td>
      <td>9</td>
      <td>5</td>
      <td>9</td>
    </tr>
    <tr>
      <th>2000-01-01 00:10:00</th>
      <td>10</td>
      <td>11</td>
      <td>10</td>
      <td>11</td>
    </tr>
  </tbody>
</table>
</div>




```python
frame = pd.DataFrame(np.random.randn(2,4),
                    index=pd.date_range('2000-1-1',periods=2,freq='W-WED'),
                    columns=['Colorado','Texas','New York','Ohio'])
```


```python
frame
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Colorado</th>
      <th>Texas</th>
      <th>New York</th>
      <th>Ohio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-05</th>
      <td>0.242780</td>
      <td>0.479366</td>
      <td>-0.538391</td>
      <td>0.349852</td>
    </tr>
    <tr>
      <th>2000-01-12</th>
      <td>1.113412</td>
      <td>0.177594</td>
      <td>0.725333</td>
      <td>-0.267360</td>
    </tr>
  </tbody>
</table>
</div>




```python
df_daily = frame.resample('D').asfreq()
```


```python
df_daily
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Colorado</th>
      <th>Texas</th>
      <th>New York</th>
      <th>Ohio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-05</th>
      <td>0.242780</td>
      <td>0.479366</td>
      <td>-0.538391</td>
      <td>0.349852</td>
    </tr>
    <tr>
      <th>2000-01-06</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2000-01-07</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2000-01-08</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2000-01-09</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2000-01-10</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2000-01-11</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2000-01-12</th>
      <td>1.113412</td>
      <td>0.177594</td>
      <td>0.725333</td>
      <td>-0.267360</td>
    </tr>
  </tbody>
</table>
</div>




```python
frame.resample('D').ffill()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Colorado</th>
      <th>Texas</th>
      <th>New York</th>
      <th>Ohio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-05</th>
      <td>0.242780</td>
      <td>0.479366</td>
      <td>-0.538391</td>
      <td>0.349852</td>
    </tr>
    <tr>
      <th>2000-01-06</th>
      <td>0.242780</td>
      <td>0.479366</td>
      <td>-0.538391</td>
      <td>0.349852</td>
    </tr>
    <tr>
      <th>2000-01-07</th>
      <td>0.242780</td>
      <td>0.479366</td>
      <td>-0.538391</td>
      <td>0.349852</td>
    </tr>
    <tr>
      <th>2000-01-08</th>
      <td>0.242780</td>
      <td>0.479366</td>
      <td>-0.538391</td>
      <td>0.349852</td>
    </tr>
    <tr>
      <th>2000-01-09</th>
      <td>0.242780</td>
      <td>0.479366</td>
      <td>-0.538391</td>
      <td>0.349852</td>
    </tr>
    <tr>
      <th>2000-01-10</th>
      <td>0.242780</td>
      <td>0.479366</td>
      <td>-0.538391</td>
      <td>0.349852</td>
    </tr>
    <tr>
      <th>2000-01-11</th>
      <td>0.242780</td>
      <td>0.479366</td>
      <td>-0.538391</td>
      <td>0.349852</td>
    </tr>
    <tr>
      <th>2000-01-12</th>
      <td>1.113412</td>
      <td>0.177594</td>
      <td>0.725333</td>
      <td>-0.267360</td>
    </tr>
  </tbody>
</table>
</div>




```python
frame.resample('D').ffill(limit=2)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Colorado</th>
      <th>Texas</th>
      <th>New York</th>
      <th>Ohio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-05</th>
      <td>0.242780</td>
      <td>0.479366</td>
      <td>-0.538391</td>
      <td>0.349852</td>
    </tr>
    <tr>
      <th>2000-01-06</th>
      <td>0.242780</td>
      <td>0.479366</td>
      <td>-0.538391</td>
      <td>0.349852</td>
    </tr>
    <tr>
      <th>2000-01-07</th>
      <td>0.242780</td>
      <td>0.479366</td>
      <td>-0.538391</td>
      <td>0.349852</td>
    </tr>
    <tr>
      <th>2000-01-08</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2000-01-09</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2000-01-10</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2000-01-11</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2000-01-12</th>
      <td>1.113412</td>
      <td>0.177594</td>
      <td>0.725333</td>
      <td>-0.267360</td>
    </tr>
  </tbody>
</table>
</div>




```python
frame.resample('W-THU').ffill()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Colorado</th>
      <th>Texas</th>
      <th>New York</th>
      <th>Ohio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-06</th>
      <td>0.242780</td>
      <td>0.479366</td>
      <td>-0.538391</td>
      <td>0.349852</td>
    </tr>
    <tr>
      <th>2000-01-13</th>
      <td>1.113412</td>
      <td>0.177594</td>
      <td>0.725333</td>
      <td>-0.267360</td>
    </tr>
  </tbody>
</table>
</div>




```python
frame = pd.DataFrame(np.random.randn(24,4),
                    index=pd.period_range('2000-1-1',periods=24,freq='M'),
                    columns=['Colorado','Texas','New York','Ohio'])
```


```python
frame
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Colorado</th>
      <th>Texas</th>
      <th>New York</th>
      <th>Ohio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01</th>
      <td>-1.706297</td>
      <td>-0.522670</td>
      <td>0.491575</td>
      <td>-0.660554</td>
    </tr>
    <tr>
      <th>2000-02</th>
      <td>0.697594</td>
      <td>0.155183</td>
      <td>-0.877326</td>
      <td>-0.010510</td>
    </tr>
    <tr>
      <th>2000-03</th>
      <td>-0.236695</td>
      <td>1.864248</td>
      <td>-0.715964</td>
      <td>-1.488638</td>
    </tr>
    <tr>
      <th>2000-04</th>
      <td>-1.018391</td>
      <td>-2.285689</td>
      <td>-2.186594</td>
      <td>-0.599815</td>
    </tr>
    <tr>
      <th>2000-05</th>
      <td>0.320080</td>
      <td>-0.296345</td>
      <td>-0.610143</td>
      <td>-1.464778</td>
    </tr>
    <tr>
      <th>2000-06</th>
      <td>-0.247478</td>
      <td>-0.202120</td>
      <td>0.823205</td>
      <td>0.481743</td>
    </tr>
    <tr>
      <th>2000-07</th>
      <td>-0.143312</td>
      <td>0.087150</td>
      <td>-0.238868</td>
      <td>1.125378</td>
    </tr>
    <tr>
      <th>2000-08</th>
      <td>-2.258384</td>
      <td>1.076038</td>
      <td>-1.360848</td>
      <td>1.546451</td>
    </tr>
    <tr>
      <th>2000-09</th>
      <td>0.617728</td>
      <td>0.936452</td>
      <td>1.095566</td>
      <td>-0.071419</td>
    </tr>
    <tr>
      <th>2000-10</th>
      <td>0.270818</td>
      <td>-0.317820</td>
      <td>0.078357</td>
      <td>-0.740768</td>
    </tr>
    <tr>
      <th>2000-11</th>
      <td>2.373465</td>
      <td>0.564065</td>
      <td>0.497542</td>
      <td>1.453533</td>
    </tr>
    <tr>
      <th>2000-12</th>
      <td>-1.666649</td>
      <td>1.296659</td>
      <td>-1.122788</td>
      <td>-0.549529</td>
    </tr>
    <tr>
      <th>2001-01</th>
      <td>0.065656</td>
      <td>1.437920</td>
      <td>-1.000678</td>
      <td>-0.316281</td>
    </tr>
    <tr>
      <th>2001-02</th>
      <td>0.947723</td>
      <td>0.064602</td>
      <td>0.381279</td>
      <td>-0.884653</td>
    </tr>
    <tr>
      <th>2001-03</th>
      <td>-0.853388</td>
      <td>0.575786</td>
      <td>-1.730335</td>
      <td>0.066510</td>
    </tr>
    <tr>
      <th>2001-04</th>
      <td>-0.462721</td>
      <td>1.867258</td>
      <td>-0.628059</td>
      <td>0.533747</td>
    </tr>
    <tr>
      <th>2001-05</th>
      <td>-0.835846</td>
      <td>-1.252669</td>
      <td>1.319334</td>
      <td>-0.069682</td>
    </tr>
    <tr>
      <th>2001-06</th>
      <td>1.690966</td>
      <td>0.397578</td>
      <td>-0.352459</td>
      <td>0.248110</td>
    </tr>
    <tr>
      <th>2001-07</th>
      <td>-0.334483</td>
      <td>0.275057</td>
      <td>0.296608</td>
      <td>0.655680</td>
    </tr>
    <tr>
      <th>2001-08</th>
      <td>-0.136816</td>
      <td>-0.967064</td>
      <td>1.107701</td>
      <td>0.056191</td>
    </tr>
    <tr>
      <th>2001-09</th>
      <td>-0.353868</td>
      <td>-0.551329</td>
      <td>-0.094478</td>
      <td>1.883897</td>
    </tr>
    <tr>
      <th>2001-10</th>
      <td>0.582112</td>
      <td>0.478270</td>
      <td>0.004481</td>
      <td>0.141597</td>
    </tr>
    <tr>
      <th>2001-11</th>
      <td>0.523303</td>
      <td>-1.153943</td>
      <td>0.104119</td>
      <td>-0.873538</td>
    </tr>
    <tr>
      <th>2001-12</th>
      <td>-1.089623</td>
      <td>-0.147164</td>
      <td>0.644278</td>
      <td>1.789630</td>
    </tr>
  </tbody>
</table>
</div>




```python
annual_frame = frame.resample('A-DEC').mean()
```


```python
annual_frame
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Colorado</th>
      <th>Texas</th>
      <th>New York</th>
      <th>Ohio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000</th>
      <td>-0.249793</td>
      <td>0.196262</td>
      <td>-0.343857</td>
      <td>-0.081575</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>-0.021415</td>
      <td>0.085358</td>
      <td>0.004316</td>
      <td>0.269268</td>
    </tr>
  </tbody>
</table>
</div>




```python
annual_frame.resample('Q-DEC').ffill()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Colorado</th>
      <th>Texas</th>
      <th>New York</th>
      <th>Ohio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000Q1</th>
      <td>-0.249793</td>
      <td>0.196262</td>
      <td>-0.343857</td>
      <td>-0.081575</td>
    </tr>
    <tr>
      <th>2000Q2</th>
      <td>-0.249793</td>
      <td>0.196262</td>
      <td>-0.343857</td>
      <td>-0.081575</td>
    </tr>
    <tr>
      <th>2000Q3</th>
      <td>-0.249793</td>
      <td>0.196262</td>
      <td>-0.343857</td>
      <td>-0.081575</td>
    </tr>
    <tr>
      <th>2000Q4</th>
      <td>-0.249793</td>
      <td>0.196262</td>
      <td>-0.343857</td>
      <td>-0.081575</td>
    </tr>
    <tr>
      <th>2001Q1</th>
      <td>-0.021415</td>
      <td>0.085358</td>
      <td>0.004316</td>
      <td>0.269268</td>
    </tr>
    <tr>
      <th>2001Q2</th>
      <td>-0.021415</td>
      <td>0.085358</td>
      <td>0.004316</td>
      <td>0.269268</td>
    </tr>
    <tr>
      <th>2001Q3</th>
      <td>-0.021415</td>
      <td>0.085358</td>
      <td>0.004316</td>
      <td>0.269268</td>
    </tr>
    <tr>
      <th>2001Q4</th>
      <td>-0.021415</td>
      <td>0.085358</td>
      <td>0.004316</td>
      <td>0.269268</td>
    </tr>
  </tbody>
</table>
</div>




```python
annual_frame.resample('Q-DEC', convention='end').ffill()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Colorado</th>
      <th>Texas</th>
      <th>New York</th>
      <th>Ohio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000Q4</th>
      <td>-0.249793</td>
      <td>0.196262</td>
      <td>-0.343857</td>
      <td>-0.081575</td>
    </tr>
    <tr>
      <th>2001Q1</th>
      <td>-0.249793</td>
      <td>0.196262</td>
      <td>-0.343857</td>
      <td>-0.081575</td>
    </tr>
    <tr>
      <th>2001Q2</th>
      <td>-0.249793</td>
      <td>0.196262</td>
      <td>-0.343857</td>
      <td>-0.081575</td>
    </tr>
    <tr>
      <th>2001Q3</th>
      <td>-0.249793</td>
      <td>0.196262</td>
      <td>-0.343857</td>
      <td>-0.081575</td>
    </tr>
    <tr>
      <th>2001Q4</th>
      <td>-0.021415</td>
      <td>0.085358</td>
      <td>0.004316</td>
      <td>0.269268</td>
    </tr>
  </tbody>
</table>
</div>




```python
close_px_all = pd.read_csv('examples/stock_px_2.csv',parse_dates=True,index_col=0)
```


```python
close_px = close_px_all[['AAPL','MSFT','XOM']]
```


```python
close_px = close_px.resample('B').ffill()
```




    <AxesSubplot:>




```python
%matplotlib inline
```


```python
close_px.AAPL.plot()
```




    <AxesSubplot:>




    
![png](https://github.com/fendao/imgs/blob/main/usepy_11/output_225_1.png)
    



```python
close_px.AAPL.rolling(250).mean().plot()
```




    <AxesSubplot:>




    
![png](https://github.com/fendao/imgs/blob/main/usepy_11/output_226_1.png)
    



```python
appl_std250 = close_px.AAPL.rolling(250, min_periods=10).std()
```


```python
appl_std250[5:12]
```




    2003-01-09         NaN
    2003-01-10         NaN
    2003-01-13         NaN
    2003-01-14         NaN
    2003-01-15    0.077496
    2003-01-16    0.074760
    2003-01-17    0.112368
    Freq: B, Name: AAPL, dtype: float64




```python
appl_std250.plot()
```




    <AxesSubplot:>




    
![png](https://github.com/fendao/imgs/blob/main/usepy_11/output_229_1.png)
    



```python
expanding_mean = appl_std250.expanding().mean()
```


```python
close_px.rolling(60).mean().plot(logy=True)
```




    <AxesSubplot:>




    
![png](https://github.com/fendao/imgs/blob/main/usepy_11/output_231_1.png)
    



```python
close_px.rolling('20D').mean()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AAPL</th>
      <th>MSFT</th>
      <th>XOM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2003-01-02</th>
      <td>7.400000</td>
      <td>21.110000</td>
      <td>29.220000</td>
    </tr>
    <tr>
      <th>2003-01-03</th>
      <td>7.425000</td>
      <td>21.125000</td>
      <td>29.230000</td>
    </tr>
    <tr>
      <th>2003-01-06</th>
      <td>7.433333</td>
      <td>21.256667</td>
      <td>29.473333</td>
    </tr>
    <tr>
      <th>2003-01-07</th>
      <td>7.432500</td>
      <td>21.425000</td>
      <td>29.342500</td>
    </tr>
    <tr>
      <th>2003-01-08</th>
      <td>7.402000</td>
      <td>21.402000</td>
      <td>29.240000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2011-10-10</th>
      <td>389.351429</td>
      <td>25.602143</td>
      <td>72.527857</td>
    </tr>
    <tr>
      <th>2011-10-11</th>
      <td>388.505000</td>
      <td>25.674286</td>
      <td>72.835000</td>
    </tr>
    <tr>
      <th>2011-10-12</th>
      <td>388.531429</td>
      <td>25.810000</td>
      <td>73.400714</td>
    </tr>
    <tr>
      <th>2011-10-13</th>
      <td>388.826429</td>
      <td>25.961429</td>
      <td>73.905000</td>
    </tr>
    <tr>
      <th>2011-10-14</th>
      <td>391.038000</td>
      <td>26.048667</td>
      <td>74.185333</td>
    </tr>
  </tbody>
</table>
<p>2292 rows × 3 columns</p>
</div>




```python
aapl_px = close_px.AAPL['2006':'2007']
```


```python
ma60 = aapl_px.rolling(30,min_periods=20).mean()
```


```python
ewma60 = aapl_px.ewm(span=30).mean()
```


```python
ma60.plot(style='k--',label='Simple MA')
ewma60.plot(style='k-',label='EW MA')
plt.legend()
```




    <matplotlib.legend.Legend at 0x7f9d1841e650>




    
![png](https://github.com/fendao/imgs/blob/main/usepy_11/output_236_1.png)
    



```python
spx_px = close_px_all['SPX']
```


```python
spx_rets = spx_px.pct_change()
```


```python
returns = close_px.pct_change()
```


```python
corr = returns.AAPL.rolling(125, min_periods=100).corr(spx_rets)
```


```python
corr.plot()
```




    <AxesSubplot:>




    
![png](https://github.com/fendao/imgs/blob/main/usepy_11/output_241_1.png)
    



```python
corr = returns.rolling(125, min_periods=100).corr(spx_rets)
```


```python
corr.plot()
```




    <AxesSubplot:>




    
![png](https://github.com/fendao/imgs/blob/main/usepy_11/output_243_1.png)
    



```python
from scipy.stats import percentileofscore
```


```python
score_at_2percent = lambda x: percentileofscore(x, 0.02)
```


```python
result = returns.AAPL.rolling(250).apply(score_at_2percent)
```


```python
result.plot()
```




    <AxesSubplot:>




    
![png](https://github.com/fendao/imgs/blob/main/usepy_11/output_247_1.png)
    

